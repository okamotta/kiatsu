<!DOCTYPE html>
<html lang="ja" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°—åœ§Ã—é ­ç—›ãƒ­ã‚°</title>
    <link rel="manifest" href="manifest.webmanifest">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
        tailwind.config = { darkMode: 'class' }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- ã“ã“ã‹ã‚‰å¤‰æ›´ -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <!-- ã“ã“ã¾ã§å¤‰æ›´ -->
    <style>
        /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã¤ã¾ã¿ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #4f46e5; /* Indigo */
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid #fff;
            box-shadow: 0 0 2px rgba(0,0,0,0.3);
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #4f46e5; /* Indigo */
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid #fff;
            box-shadow: 0 0 2px rgba(0,0,0,0.3);
        }
        /* ã“ã“ã‹ã‚‰æŒ¿å…¥ */
        .risk-strip{ display:grid; grid-template-columns: repeat(72,1fr);
                     height:36px; border-radius:8px; overflow:hidden; background:#eee; }
        .dark .risk-strip{ background:#374151; }
        .risk-cell{ height:100%; }
        .risk-low{  background:#c6f6d5; }  /* ç·‘ */
        .risk-med{  background:#fde68a; }  /* é»„ */
        .risk-high{ background:#fecaca; }  /* èµ¤ */
        .risk-tick{ border-right:1px solid rgba(0,0,0,.06); }
        .dark .risk-tick{ border-right:1px solid rgba(255,255,255,.08); }
        /* ã“ã“ã¾ã§æŒ¿å…¥ */
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-700 dark:text-slate-300 transition-colors duration-300">

    <div class="container mx-auto p-4 max-w-2xl">

        <!-- (ãƒ˜ãƒƒãƒ€ãƒ¼ã‚„éƒ½å¸‚æ¤œç´¢éƒ¨åˆ†ã¯å¤‰æ›´ãªã—) -->
        <header class="text-center mb-8 relative">
            <h1 class="text-4xl font-bold text-slate-800 dark:text-slate-200">Zutsu Log</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-2">æ°—åœ§ã®å¤‰åŒ–ã¨ã‚ãªãŸã®é ­ç—›ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚</p>
            <button id="theme-toggle" class="absolute top-0 right-0 p-2 rounded-full text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 focus:outline-none transition-colors">
                <svg id="theme-toggle-dark-icon" class="hidden h-6 w-6" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                <svg id="theme-toggle-light-icon" class="hidden h-6 w-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-.707 7.071a1 1 0 011.414 0l.707.707a1 1 0 11-1.414 1.414l-.707-.707a1 1 0 010-1.414zM3 11a1 1 0 100-2H2a1 1 0 100 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
            </button>
        </header>
        <div id="warningBanner" class="hidden bg-red-100 dark:bg-red-900/30 border-l-4 border-red-500 text-red-700 dark:text-red-300 p-4 mb-6 rounded-2xl shadow-lg" role="alert">
            <p class="font-bold">æ€¥æ¿€ãªæ°—åœ§ä½ä¸‹ã‚’æ¤œçŸ¥</p>
            <p>ä½“èª¿ã®å¤‰åŒ–ã«ã”æ³¨æ„ãã ã•ã„ã€‚</p>
        </div>
        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg mb-6">
            <h2 class="text-xl font-semibold mb-4 text-slate-800 dark:text-slate-200">å ´æ‰€ã‚’é¸æŠ</h2>
            <div class="flex flex-col sm:flex-row gap-3">
                <input type="text" id="city" placeholder="ä¾‹: æ±äº¬" class="flex-grow p-3 border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow">
                <button id="search" class="bg-indigo-600 text-white px-5 py-3 rounded-xl hover:bg-indigo-700 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">æ¤œç´¢</button>
                <button id="getLocation" class="bg-slate-500 text-white px-5 py-3 rounded-xl hover:bg-slate-600 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">ç¾åœ¨åœ°</button>
            </div>
        </div>


        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg mb-6">
            <h2 class="text-xl font-semibold mb-4 text-slate-800 dark:text-slate-200">æ°—åœ§ãƒ»é ­ç—›ã‚°ãƒ©ãƒ•</h2>
            <canvas id="pressureChart"></canvas>
            <!-- ã“ã“ã‹ã‚‰æŒ¿å…¥ -->
            <div id="riskPanel" style="margin-top:12px">
              <div style="font-size:12px;opacity:.7;margin-bottom:6px;" class="dark:text-slate-300">ã“ã‚Œã‹ã‚‰72æ™‚é–“ã®é ­ç—›ãƒªã‚¹ã‚¯</div>
              <div id="riskStrip" class="risk-strip"></div>
              <div id="riskLegend" style="display:flex;gap:8px;margin-top:6px;font-size:12px;opacity:.7;" class="dark:text-slate-300">
                <span>ğŸŸ¥ Highï¼ˆæ€¥é™ä¸‹ï¼‰</span><span>ğŸŸ¨ Mediumï¼ˆå¤§ãã„å¤‰å‹•ï¼‰</span><span>ğŸŸ© Low</span>
              </div>
            </div>
            <!-- ã“ã“ã¾ã§æŒ¿å…¥ -->
        </div>
        
        <div id="insight" class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-lg mb-6 text-center text-lg font-semibold"></div>

        <!-- (é ­ç—›è¨˜éŒ²ã€ã—ãã„å€¤è¨­å®šã€ãƒ•ãƒƒã‚¿ãƒ¼ãªã©ã¯å¤‰æ›´ãªã—) -->
        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg mb-6">
            <h2 class="text-xl font-semibold mb-4 text-slate-800 dark:text-slate-200">é ­ç—›ã‚’è¨˜éŒ²ã™ã‚‹</h2>
            <div class="flex flex-col sm:flex-row items-center gap-4">
                <label for="headacheScore" class="font-medium flex-shrink-0">ä»Šã®é ­ç—›ãƒ¬ãƒ™ãƒ«</label>
                <input type="range" id="headacheScore" min="0" max="5" value="0" class="flex-grow h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer">
                <span id="scoreValue" class="font-bold text-indigo-600 dark:text-indigo-400 text-2xl w-8 text-center">0</span>
                <button id="saveScore" class="bg-indigo-600 text-white px-6 py-3 rounded-xl hover:bg-indigo-700 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">è¨˜éŒ²</button>
            </div>
        </div>
        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-lg mb-6">
            <h2 class="text-xl font-semibold mb-4 text-slate-800 dark:text-slate-200">æ³¨æ„è¡¨ç¤ºã®ã—ãã„å€¤</h2>
            <div class="flex flex-col sm:flex-row items-center gap-4">
                <label for="thresholdSlider" class="font-medium flex-shrink-0">æ°—åœ§ä½ä¸‹ (hPa/3h)</label>
                <input type="range" id="thresholdSlider" min="-10" max="-1" value="-6" class="flex-grow h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer">
                <span id="thresholdValue" class="font-bold text-indigo-600 dark:text-indigo-400 text-lg w-16 text-center">-6 hPa</span>
            </div>
        </div>
        <div class="my-8 text-center">
            <button id="exportCsv" class="bg-slate-600 text-white px-6 py-3 rounded-xl hover:bg-slate-700 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">é ­ç—›ãƒ‡ãƒ¼ã‚¿ã‚’CSVã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
        </div>
        <footer class="text-center mt-12 text-sm text-slate-500 dark:text-slate-400">
            <p>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯åŒ»ç™‚çš„ãªè¨ºæ–­ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¡¨ç¤ºã•ã‚Œã‚‹æƒ…å ±ã¯ã‚ãã¾ã§å‚è€ƒæƒ…å ±ã¨ã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚</p>
        </footer>

    </div>

    <script src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>